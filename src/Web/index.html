<!DOCTYPE html>
<html lang="ES">

<head>
  <meta charset="UTF-8">
  <meta name="description" content="Mapa de contaminación de Gandía">
  <meta name="keywords" content="Gases, Medioambiente, Mapas, Gandía, Turismo, Salud">
  <meta name="author" content="David Fernández Fuster">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Lecturas de SO2</title>
</head>

<body>
  <header></header>
  <main>
    <h1>Lecturas SO2</h1>
    <div id="lecturas"></div>
  </main>
  <footer></footer>
</body>
<script>
  // Al cargar la página, esta pide un nuevo objeto XML mediante petición HTTP.
  var peticionLecturas = new XMLHttpRequest();

  // Dicha petición, es una petición GET que se manda al archivo PHP lecturasREST.
  peticionLecturas.open("get", "lecturasREST.php", true);
  peticionLecturas.send();
  
  // Tras recibir respuesta a dicha petición...
  peticionLecturas.onload = function () {
    
    // ...esta aparece bajo la forma de "this.responseText", un texto con un formato que recuerda al de JSON.
    // Como al final de dicho texto se encuentra "[]", no cumple con el convenio del formato JSON.
    var textoJSON_noApto = this.responseText;

    // Debido a eso, se le quitan esos dos carácteres. 
    var textoJSON_Apto = textoJSON_noApto.substring(0, textoJSON_noApto.length - 4);

    // Ahora el texto ya es apto para pasarlo a JSON.
    var json = JSON.parse(textoJSON_Apto);

    // Una vez pasado a dicha formato, y por cada objeto en dicho JSON, se accede a sus propiedades.
    // (En este protipo solo se imprime la propiedad valor del último objeto)
    for (lectura in json) {
      document.getElementById("lecturas").innerHTML = json[lectura].valor;
    }
  };
</script>

</html>